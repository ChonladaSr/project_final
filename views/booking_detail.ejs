<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Skill Deck</title>
    <%- include('./font') %>
        <link rel="icon" href="https://cdn-icons-png.freepik.com/512/9169/9169949.png?ga=GA1.1.512366322.1722083948">
        <script src="https://cdn.tailwindcss.com"></script>

        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
            integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        padding: 0;
    }

    .container {
        max-width: 100px;
        margin: 50px auto;
        padding: 20px;
        background: #fff;
        border-radius: 8px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        display: flex;
        flex-direction: row;
        justify-content: space-between;
        align-items: flex-start;
    }

    .details {
        flex: 1;
        padding-right: 20px;
    }

    .timeline-section {
        flex: 1;
        padding-left: 20px;
    }

    h1 {
        text-align: center;
        color: #333;
    }

    .timeline {
        position: relative;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 10px 0;
        margin-top: 20px;
    }

    .timeline-item {
        position: relative;
        text-align: center;
        z-index: 2;
    }

    .timeline-circle {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background: #ddd;
        border: 3px solid #4caf50;
        position: relative;
        z-index: 2;
    }

    .timeline-circle.pending {
        background: #ff9800;
        /* Color for Pending */
    }

    .timeline-circle.in-progress {
        background: #4caf50;
        /* Color for In Progress */
    }

    .timeline-content {
        margin-top: 10px;
        padding: 10px;
        background: #fff;
        border-radius: 4px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
    }

    .timeline-content h3 {
        margin: 0;
        color: #333;
    }

    .timeline-content p {
        margin: 5px 0;
        color: #666;
    }

    .timeline-connector {
        flex: 1;
        height: 2px;
        background: #000000;
        position: relative;
        align-self: center;
        z-index: 1;
    }

    .rating {
        display: inline-block;
    }

    .rating input {
        display: none;
    }

    .rating label {
        float: right;
        cursor: pointer;
        transition: color 0.3s;
    }

    .rating label:before {
        content: "\2605";
        font-size: 30px;
    }

    .rating input:checked~label,
    .rating label:hover,
    .rating label:hover~label {
        color: #ffd700;
        transition: color 0.3s;
    }
</style>

<body onload="showAlert()">
    <%- include('./partials/header') %>

        <div class="container">
            <!-- Left Side: Booking Details -->
            <div class="details">
                <p class="prompt-medium text-orange-500 mt-2">รายละเอียดการจอง</p>
                <p class="prompt-regular mt-1">หมายเลขการจอง #<%= booking.id %>
                </p>
                <p class="prompt-regular mt-1">รายละเอียด: <%= booking.service_details %>
                </p>
                <p class="prompt-regular mt-1">ชื่อผู้จอง: <%= booking.name %>
                </p>
                <p class="prompt-regular mt-1">วันนัดหมาย:
                    <% const bookingDate=new Date(booking.booking_date); const
                        thaiDate=bookingDate.toLocaleDateString('th-TH', { weekday: 'long' , year: 'numeric' ,
                        month: 'long' , day: 'numeric' }); const thaiTime=bookingDate.toLocaleTimeString('th-TH'); %>
                        <%= thaiDate %>
                </p>
                <p class="prompt-regular mt-1">เวลานัดหมาย: <%= booking.booking_time %>
                </p>
                <hr style="width: 50%" class="mt-2">
                <p class="prompt-medium text-orange-500 mt-2">ข้อมูลช่างที่จอง</p>
                <p class="prompt-regular">ชื่อ: <%= booking.team_name %>
                </p>
                <p class="prompt-regular">เบอร์โทรศัพท์: <%= booking.team_phone %>
                </p>
                <p class="prompt-regular">อีเมล: <%= booking.team_email %>
                </p>
                <hr style="width: 50%" class="mt-2">
                <p class="prompt-medium text-orange-500 mt-2">สถานะการจอง</p>
                <p class="prompt-regular">
                    <span id="status-text">
                        <% if (booking.payment_status==='รอการตรวจสอบ' ) { %>
                            รอการตรวจสอบ
                            <% } else if (booking.payment_status==='ยืนยัน' ) { %>
                                <%= booking.status %>
                                    <% } %>
                    </span>
                </p>



            </div>


            <!-- Right Side: Timeline -->
            <div class="timeline-section">
                <div class="p-4 max-w-md mx-auto pt-20 flow-root">
                    <ul role="list" class="-mb-8">
                        <% if (booking.cancelled_at) { %>
                            <!-- แสดงสถานะ ยกเลิก -->
                            <li>
                                <div class="relative pb-8">
                                    <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                        aria-hidden="true"></span>
                                    <div class="relative flex space-x-3">
                                        <div>
                                            <span
                                                class="h-8 w-8 rounded-full bg-red-500 flex items-center justify-center ring-8 ring-white">
                                                <svg class="h-5 w-5 text-white" viewBox="0 0 20 20" fill="currentColor"
                                                    aria-hidden="true">
                                                    <path
                                                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 00-2 0v5a1 1 0 002 0V7zm0 7a1 1 0 00-2 0v1a1 1 0 002 0v-1z" />
                                                </svg>
                                            </span>
                                        </div>
                                        <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                            <div>
                                                <p class="text-sm text-gray-800 prompt-regular">ยกเลิก</p>
                                            </div>
                                            <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                                <time>
                                                    <%= new Date(booking.cancelled_at).toLocaleString('th-TH', {
                                                        timeZone: 'Asia/Bangkok' }) %>
                                                </time>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </li>
                            <% } else if (booking.payment_status==='รอการตรวจสอบ' ) { %>
                                <!-- แสดงสถานะ รอการตรวจสอบ -->
                                <li>
                                    <div class="relative pb-8">
                                        <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                            aria-hidden="true"></span>
                                        <div class="relative flex space-x-3">
                                            <div>
                                                <span
                                                    class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center ring-8 ring-white">
                                                    <svg class="h-5 w-5 text-white" viewBox="0 0 20 20"
                                                        fill="currentColor" aria-hidden="true">
                                                        <path
                                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 00-2 0v5a1 1 0 002 0V7zm0 7a1 1 0 00-2 0v1a1 1 0 002 0v-1z" />
                                                    </svg>
                                                </span>
                                            </div>
                                            <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                                <div>
                                                    <p class="text-sm text-gray-800 prompt-regular">รอการตรวจสอบ</p>
                                                </div>
                                                <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                                    <time class="prompt-light text-xs">
                                                        <%= new Date(booking.created_at).toLocaleString('th-TH', {
                                                            timeZone: 'Asia/Bangkok' }) %>
                                                    </time>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </li>
                                <% } else if (booking.payment_status==='ยืนยัน' ) { %>
                                    <!-- แสดงสถานะ รอดำเนินการ -->
                                    <li>
                                        <div class="relative pb-8">
                                            <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                                aria-hidden="true"></span>
                                            <div class="relative flex space-x-3">
                                                <div>
                                                    <span
                                                        class="h-8 w-8 rounded-full bg-yellow-500 flex items-center justify-center ring-8 ring-white">
                                                        <svg class="h-5 w-5 text-white" viewBox="0 0 20 20"
                                                            fill="currentColor" aria-hidden="true">
                                                            <path
                                                                d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 00-2 0v5a1 1 0 002 0V7zm0 7a1 1 0 00-2 0v1a1 1 0 002 0v-1z" />
                                                        </svg>
                                                    </span>
                                                </div>
                                                <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                                    <div>
                                                        <p class="text-sm text-gray-800 prompt-regular">รอดำเนินการ</p>
                                                    </div>
                                                    <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                                        <time class="prompt-light text-xs">
                                                            <%= new Date(booking.created_at).toLocaleString('th-TH', {
                                                                timeZone: 'Asia/Bangkok' }) %>
                                                        </time>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </li>
                                    <!-- แสดงสถานะ กำลังดำเนินการ -->
                                    <% if (booking.approved_at) { %>
                                        <li>
                                            <div class="relative pb-8">
                                                <span class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                                    aria-hidden="true"></span>
                                                <div class="relative flex space-x-3">
                                                    <div>
                                                        <span
                                                            class="h-8 w-8 rounded-full bg-blue-500 flex items-center justify-center ring-8 ring-white">
                                                            <svg class="h-5 w-5 text-white" viewBox="0 0 20 20"
                                                                fill="currentColor" aria-hidden="true">
                                                                <path
                                                                    d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 00-2 0v5a1 1 0 002 0V7zm0 7a1 1 0 00-2 0v1a1 1 0 002 0v-1z" />
                                                            </svg>
                                                        </span>
                                                    </div>
                                                    <div class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                                        <div>
                                                            <p class="text-sm text-gray-800 prompt-regular">
                                                                กำลังดำเนินการ</p>
                                                        </div>
                                                        <div class="whitespace-nowrap text-right text-sm text-gray-500">
                                                            <time class="prompt-light text-xs">
                                                                <%= new
                                                                    Date(booking.approved_at).toLocaleString('th-TH', {
                                                                    timeZone: 'Asia/Bangkok' }) %>
                                                            </time>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </li>
                                        <% } %>
                                            <!-- แสดงสถานะ ยืนยันงาน -->
                                            <% if (booking.confirmed_at) { %>
                                                <li>
                                                    <div class="relative pb-8">
                                                        <span
                                                            class="absolute left-4 top-4 -ml-px h-full w-0.5 bg-gray-200"
                                                            aria-hidden="true"></span>
                                                        <div class="relative flex space-x-3">
                                                            <div>
                                                                <span
                                                                    class="h-8 w-8 rounded-full bg-green-500 flex items-center justify-center ring-8 ring-white">
                                                                    <svg class="h-5 w-5 text-white" viewBox="0 0 20 20"
                                                                        fill="currentColor" aria-hidden="true">
                                                                        <path
                                                                            d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-11a1 1 0 00-2 0v5a1 1 0 002 0V7zm0 7a1 1 0 00-2 0v1a1 1 0 002 0v-1z" />
                                                                    </svg>
                                                                </span>
                                                            </div>
                                                            <div
                                                                class="flex min-w-0 flex-1 justify-between space-x-4 pt-1.5">
                                                                <div>
                                                                    <p class="text-sm text-gray-800 prompt-regular">
                                                                        ยืนยันงาน</p>
                                                                </div>
                                                                <div
                                                                    class="whitespace-nowrap text-right text-sm text-gray-500">
                                                                    <time class="prompt-light text-xs">
                                                                        <%= new
                                                                            Date(booking.confirmed_at).toLocaleString('th-TH',
                                                                            { timeZone: 'Asia/Bangkok' }) %>
                                                                    </time>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </li>
                                                <% } %>
                                                    <% } %>
                    </ul>
                </div>

            </div>
            <!-- Show Cancel or Review Button -->
            <% if (booking.status !=='ยกเลิกการจอง' && booking.status !=='ยืนยันงาน' && booking.status !=='กำลังดำเนินการ' ) { %>
                <form action="/bookings/<%= booking.id %>/cancel" method="POST">
                    <button type="submit" class="prompt-bold btn btn-danger mt-4">ยกเลิกการจอง</button>
                </form>
                <% } else if (booking.status==='ยืนยันงาน' ) { %>
                    <form action="/bookings/<%= booking.id %>/review" method="POST">
                        <!--<button type="submit" class="prompt-bold btn btn-primary mt-4">รีวิวงานนี้</button>-->
                    </form>
                    <% } else { %>
                        <p class="prompt-medium text-red-500">การจองนี้ถูกยกเลิกแล้ว</p>
                        <% } %>

                            <% if (booking.status==='ยืนยันงาน' && !booking.review) { %>
                                <form action="/bookings/<%= booking.id %>/review" method="POST" class="mt-4">
                                    <div class="flex items-center">
                                        <label class="prompt-bold">ให้คะแนน:</label>
                                        <div class="ml-2">
                                            <div class="rating">
                                                <% for (let i=1; i <=5; i++) { %>
                                                    <input type="radio" id="star<%= i %>" name="rating" value="<%= i %>"
                                                        required />
                                                    <label for="star<%= i %>"></label>
                                                    <% } %>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="mt-4">
                                        <label for="comment" class="prompt-bold">คอมเมนต์:</label>
                                        <textarea name="comment" id="comment" rows="4"
                                            class="form-textarea mt-1 block w-full prompt-regular border border-black"
                                            required></textarea>
                                    </div>
                                    <button type="submit" class="prompt-bold btn btn-primary mt-4">ส่งรีวิว</button>
                                </form>
                                <% } %>

        </div>


</body>

</html>